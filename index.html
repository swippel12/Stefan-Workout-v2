<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="12M Training">
<meta name="theme-color" content="#0a0a0a">
<title>Stefan Workout</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;900&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0a0a0a;--surface:#141414;--surface2:#1e1e1e;--surface3:#282828;--border:#2a2a2a;--text:#f0f0f0;--text-dim:#888;--text-muted:#555;--accent:#e8ff00;--accent-dim:#b5c700;--red:#ff4444;--green:#44ff88;--phase1:#e8ff00;--phase2:#ff8c00;--phase3:#00d4ff;--bc:'Barlow Condensed',sans-serif;--b:'Barlow',sans-serif;--sat:env(safe-area-inset-top, 44px);--sab:env(safe-area-inset-bottom, 16px)}
  *{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
  html,body{height:100%;background:var(--bg);color:var(--text);font-family:var(--b);overflow:hidden}
  .screen{position:absolute;inset:0;display:none;flex-direction:column;overflow:hidden}
  .screen.active{display:flex;animation:fadeIn .2s ease}
  #workout-screen{position:absolute;top:0;left:0;right:0;bottom:calc(44px + var(--sab));display:none;flex-direction:column;overflow:hidden;background:var(--bg)}
  #workout-screen.active{display:flex}
  #workout-screen.active ~ #bottom-nav{display:flex}
  #setup-screen{align-items:center;justify-content:center;padding:32px 28px;background:linear-gradient(160deg,#0a0a0a 0%,#111 100%)}
  .setup-logo{font-family:var(--bc);font-size:64px;font-weight:900;line-height:.9;letter-spacing:-2px;color:var(--accent);text-align:center;margin-bottom:10px}
  .setup-sub{font-family:var(--bc);font-size:14px;font-weight:600;letter-spacing:4px;color:var(--text-dim);text-transform:uppercase;text-align:center;margin-bottom:48px}
  .setup-label{font-family:var(--bc);font-size:12px;font-weight:700;letter-spacing:3px;color:var(--text-dim);text-transform:uppercase;margin-bottom:8px;align-self:flex-start;width:100%}
  .setup-input{width:100%;background:var(--surface2);border:1px solid var(--border);color:var(--text);font-family:var(--b);font-size:16px;padding:14px 16px;border-radius:6px;margin-bottom:28px;-webkit-appearance:none}
  .setup-input:focus{outline:none;border-color:var(--accent)}
  .btn-primary{width:100%;background:var(--accent);color:#000;font-family:var(--bc);font-size:18px;font-weight:900;letter-spacing:2px;text-transform:uppercase;padding:16px;border:none;border-radius:6px;cursor:pointer;transition:opacity .15s}
  .btn-primary:active{opacity:.8}
  #home-screen{background:var(--bg)}
  .home-header{padding:calc(var(--sat) + 8px) 20px 16px;border-bottom:1px solid var(--border);flex-shrink:0}
  .home-phase-label{font-family:var(--bc);font-size:11px;font-weight:700;letter-spacing:4px;text-transform:uppercase;margin-bottom:4px}
  .home-title{font-family:var(--bc);font-size:40px;font-weight:900;line-height:1;letter-spacing:-1px}
  .home-meta{font-size:13px;color:var(--text-dim);margin-top:4px}
  .home-week-strip{display:flex;gap:5px;padding:16px 20px 0;flex-shrink:0}
  .week-pip{flex:1;height:4px;border-radius:2px;background:var(--surface3);transition:background .3s}
  .week-pip.done{background:var(--accent-dim)}
  .week-pip.current{background:var(--accent)}
  .home-content{flex:1;overflow-y:auto;padding:16px 20px 80px}
  .deload-banner{background:var(--surface2);border:1px solid #ff8c0044;border-radius:8px;padding:12px 14px;margin-bottom:16px;display:flex;align-items:center;gap:10px}
  .deload-dot{width:7px;height:7px;border-radius:50%;background:#ff8c00;flex-shrink:0}
  .deload-text{font-size:12px;color:#ff8c00;font-weight:500}
  .section-label{font-family:var(--bc);font-size:10px;font-weight:700;letter-spacing:4px;color:var(--text-muted);text-transform:uppercase;margin-bottom:10px}
  .day-cards{display:flex;flex-direction:column;gap:8px;margin-bottom:24px}
  .day-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:15px 16px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;transition:border-color .15s,background .15s;position:relative;overflow:hidden}
  .day-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--accent)}
  .day-card.bonus::before{background:var(--text-muted)}
  .day-card:active{background:var(--surface2);border-color:var(--accent)}
  .day-card-tag{font-family:var(--bc);font-size:10px;font-weight:700;letter-spacing:3px;color:var(--text-dim);text-transform:uppercase;margin-bottom:3px}
  .day-card-name{font-family:var(--bc);font-size:20px;font-weight:700}
  .day-card-count{font-size:12px;color:var(--text-dim);margin-top:2px}
  .day-card-arrow{font-size:20px;color:var(--text-muted)}
  .day-card.completed{border-color:var(--surface3);opacity:.6}
  .day-card.completed::before{background:var(--green)}
  .day-card-undo{font-size:11px;font-family:var(--bc);font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--text-muted);background:var(--surface3);border:none;border-radius:4px;padding:5px 10px;cursor:pointer;white-space:nowrap;flex-shrink:0;transition:color .15s,background .15s}
  .day-card-undo:active{color:var(--text);background:var(--surface2)}
  .benchmark-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:15px 16px;cursor:pointer;transition:border-color .15s}
  .benchmark-card:active{border-color:var(--accent)}
  .benchmark-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .benchmark-card-title{font-family:var(--bc);font-size:17px;font-weight:700}
  .benchmark-mini-grid{display:grid;grid-template-columns:1fr 1fr;gap:7px}
  .benchmark-mini-label{font-size:10px;color:var(--text-muted);margin-bottom:2px}
  .benchmark-mini-val{font-family:var(--bc);font-size:16px;font-weight:700;color:var(--text-dim)}
  .benchmark-mini-val.filled{color:var(--accent)}
  .workout-header{padding:calc(var(--sat) + 8px) 20px 14px;border-bottom:1px solid var(--border);flex-shrink:0}
  .workout-back{font-size:15px;cursor:pointer;display:flex;align-items:center;gap:5px;margin-bottom:10px;background:none;border:none;color:var(--text-dim);font-family:var(--b);padding:10px 14px 10px 0;min-height:44px;min-width:44px;transition:color .15s}
  .workout-back:active{color:var(--text)}
  .workout-day-tag{font-family:var(--bc);font-size:11px;font-weight:700;letter-spacing:4px;color:var(--accent);text-transform:uppercase;margin-bottom:3px}
  .workout-title{font-family:var(--bc);font-size:30px;font-weight:900;line-height:1}
  .workout-progress-bar{height:3px;background:var(--surface3);margin-top:14px;border-radius:2px;overflow:hidden}
  .workout-progress-fill{height:100%;background:var(--accent);border-radius:2px;transition:width .4s ease}
  .workout-content{flex:1;overflow-y:auto;padding:0 20px 20px;-webkit-overflow-scrolling:touch}
  .top-progress-track{height:6px;background:var(--surface3);border-radius:3px;overflow:hidden}
  .top-progress-fill{height:100%;background:var(--accent);border-radius:3px;transition:width .35s ease;width:0%}
  .top-progress-label{font-family:var(--bc);font-size:10px;font-weight:700;letter-spacing:2px;color:var(--text-muted);text-transform:uppercase;text-align:right;margin-top:5px;margin-bottom:2px}
  /* Timer bar ‚Äî compact */
  .timer-bar{display:flex;align-items:center;justify-content:space-between;padding:8px 20px;background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0}
  .timer-display{font-family:var(--bc);font-size:24px;font-weight:900;color:var(--accent);letter-spacing:2px}
  .timer-controls{display:flex;gap:8px}
  .timer-btn{background:var(--surface3);border:1px solid var(--border);color:var(--text);font-family:var(--bc);font-size:12px;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:8px 14px;border-radius:6px;cursor:pointer;transition:background .15s,border-color .15s,transform .1s}
  .timer-btn:active{background:var(--surface2);transform:scale(0.93)}
  .timer-btn.running{border-color:var(--accent);color:var(--accent)}
  .timer-btn.paused{border-color:var(--phase2);color:var(--phase2)}
  .exercise-item{border-bottom:1px solid var(--border);padding:16px 0}
  .exercise-item:last-child{border-bottom:none}
  .exercise-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
  /* UPDATED: More visible exercise names */
  .exercise-name{font-family:var(--bc);font-size:26px;font-weight:900;line-height:1.1;flex:1;padding-right:10px;color:#fff;letter-spacing:-0.5px;text-transform:uppercase}
  .exercise-superset-tag{font-size:9px;font-weight:700;letter-spacing:2px;color:var(--phase3);border:1px solid var(--phase3);padding:2px 6px;border-radius:3px;text-transform:uppercase;white-space:nowrap;margin-top:5px}
  .exercise-specs{display:flex;gap:14px;margin-bottom:8px}
  .spec-label{font-size:9px;color:var(--text-muted);letter-spacing:1px;text-transform:uppercase}
  .spec-val{font-family:var(--bc);font-size:16px;font-weight:600}
  .exercise-note{font-size:12px;color:var(--text-dim);line-height:1.5;background:var(--surface2);border-radius:6px;padding:8px 10px;margin-bottom:12px}
  .exercise-note.superset-note{border-left:2px solid var(--phase3)}
  .last-weight-hint{font-size:11px;color:var(--text-muted);margin-bottom:8px;line-height:1.6}
  .last-weight-hint span{color:var(--accent-dim);font-weight:600}
  .log-sets{display:flex;flex-direction:column;gap:7px}
  .log-set-row{display:flex;align-items:center;gap:8px}
  .set-num{font-family:var(--bc);font-size:12px;font-weight:700;color:var(--text-muted);width:22px;flex-shrink:0;text-align:center}
  .log-input-wrap{flex:1;position:relative}
  .log-input-label{font-size:8px;letter-spacing:2px;color:var(--text-muted);text-transform:uppercase;position:absolute;top:5px;left:10px}
  .log-input{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:19px 10px 6px;color:var(--text);font-family:var(--bc);font-size:20px;font-weight:700;text-align:center;-webkit-appearance:none;-moz-appearance:textfield;transition:border-color .15s}
  .log-input:focus{outline:none;border-color:var(--accent)}
  .log-input.filled{border-color:var(--surface3);color:var(--accent)}
  .log-input::-webkit-inner-spin-button,.log-input::-webkit-outer-spin-button{-webkit-appearance:none}
  .rpe-select{width:70px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:19px 6px 6px;color:var(--text);font-family:var(--bc);font-size:20px;font-weight:700;text-align:center;-webkit-appearance:none;transition:border-color .15s;flex-shrink:0}
  .rpe-wrap{position:relative;flex-shrink:0;width:70px}
  .rpe-wrap .log-input-label{z-index:1}
  .rpe-select:focus{outline:none;border-color:var(--accent)}
  .rpe-select.filled{border-color:var(--surface3);color:var(--accent)}
  .set-check{width:30px;height:30px;border-radius:50%;background:var(--surface3);border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:14px;transition:background .2s}
  .set-check.done{background:var(--accent)}
  .workout-footer{padding:14px 20px 16px;border-top:1px solid var(--border);flex-shrink:0;background:var(--bg)}
  .btn-done{width:100%;background:transparent;color:var(--text);font-family:var(--bc);font-size:18px;font-weight:900;letter-spacing:2px;text-transform:uppercase;padding:16px;border:1px solid #444;border-radius:6px;cursor:pointer;transition:all .2s}
  .btn-done.ready{background:var(--accent);color:#000;border-color:var(--accent)}
  .btn-done:active{opacity:.8}
  #complete-screen{align-items:center;justify-content:center;padding:32px 28px;background:var(--bg)}
  .complete-icon{font-size:56px;margin-bottom:20px}
  .complete-title{font-family:var(--bc);font-size:48px;font-weight:900;color:var(--accent);text-align:center;line-height:1;margin-bottom:6px}
  .complete-sub{font-size:14px;color:var(--text-dim);text-align:center;margin-bottom:32px}
  .complete-stats{width:100%;display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:32px}
  .complete-stat{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:14px;text-align:center}
  .complete-stat-val{font-family:var(--bc);font-size:28px;font-weight:900;color:var(--accent)}
  .complete-stat-label{font-size:10px;color:var(--text-muted);letter-spacing:2px;text-transform:uppercase;margin-top:3px}
  #benchmark-screen{background:var(--bg)}
  .benchmark-header{padding:calc(var(--sat) + 8px) 20px 16px;border-bottom:1px solid var(--border);flex-shrink:0}
  .benchmark-content{flex:1;overflow-y:auto;padding:16px 20px 80px}
  .benchmark-lift{border-bottom:1px solid var(--border);padding:16px 0}
  .benchmark-lift:last-child{border-bottom:none}
  .benchmark-lift-name{font-family:var(--bc);font-size:18px;font-weight:700;margin-bottom:12px}
  .benchmark-phases{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:6px}
  .bpc-label{font-size:9px;color:var(--text-muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:5px}
  .bpc-input{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:8px 4px;color:var(--text);font-family:var(--bc);font-size:18px;font-weight:700;text-align:center;-webkit-appearance:none;-moz-appearance:textfield}
  .bpc-input:focus{outline:none;border-color:var(--accent)}
  .bpc-input::-webkit-inner-spin-button,.bpc-input::-webkit-outer-spin-button{-webkit-appearance:none}
  .bpc-input.filled{color:var(--accent);border-color:var(--surface3)}
  .bpc-delta{font-size:10px;text-align:center;margin-top:3px;font-weight:600;color:var(--green)}
  #history-screen{background:var(--bg)}
  .history-header{padding:calc(var(--sat) + 8px) 20px 16px;border-bottom:1px solid var(--border);flex-shrink:0}
  .history-content{flex:1;overflow-y:auto;padding:16px 20px 80px}
  .history-session{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px;margin-bottom:10px}
  .history-session-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
  .history-session-title{font-family:var(--bc);font-size:17px;font-weight:700}
  .history-session-date{font-size:11px;color:var(--text-dim)}
  .history-exercise-row{display:flex;justify-content:space-between;padding:4px 0;border-top:1px solid var(--border)}
  .history-ex-name{font-size:12px;color:var(--text-dim)}
  .history-ex-vals{font-size:12px;color:var(--accent-dim);font-weight:600}
  .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--bg);border-top:1px solid var(--border);display:none;padding:8px 0 0;padding-bottom:var(--sab);z-index:100}
  .bottom-nav.visible{display:flex}
  .nav-items{display:flex;width:100%}
  .nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;cursor:pointer;padding:3px 0;background:none;border:none;color:var(--text-muted);font-family:var(--b);font-size:9px;letter-spacing:1px;text-transform:uppercase;transition:color .15s}
  .nav-item.active{color:var(--accent)}
  .nav-icon{font-size:20px}
  .phase-1{color:var(--phase1)}.phase-2{color:var(--phase2)}.phase-3{color:var(--phase3)}
  ::-webkit-scrollbar{width:0}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  .empty-state{text-align:center;padding:48px 16px}
  .empty-state-icon{font-size:40px;margin-bottom:14px}
  .empty-state-text{font-size:14px;color:var(--text-muted)}
  #plan-screen{background:var(--bg)}
  .plan-header{padding:calc(var(--sat) + 8px) 20px 16px;border-bottom:1px solid var(--border);flex-shrink:0;display:flex;align-items:flex-end;justify-content:space-between}
  .plan-back-btn{font-size:13px;cursor:pointer;background:none;border:none;color:var(--text-dim);font-family:var(--b);padding:0;margin-bottom:6px;display:block}
  .plan-back-btn:active{color:var(--text)}
  .plan-screen-tag{font-family:var(--bc);font-size:11px;font-weight:700;letter-spacing:4px;color:var(--text-muted);text-transform:uppercase;margin-bottom:3px}
  .plan-screen-title{font-family:var(--bc);font-size:32px;font-weight:900;line-height:1}
  .plan-content{flex:1;overflow-y:auto;padding:16px 20px 90px}
  .phase-block{margin-bottom:28px}
  .phase-block-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
  .phase-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
  .phase-block-title{font-family:var(--bc);font-size:13px;font-weight:700;letter-spacing:3px;text-transform:uppercase}
  .month-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .month-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px;cursor:pointer;transition:border-color .15s,background .15s;position:relative;overflow:hidden}
  .month-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px}
  .month-card.phase-1-card::before{background:var(--phase1)}
  .month-card.phase-2-card::before{background:var(--phase2)}
  .month-card.phase-3-card::before{background:var(--phase3)}
  .month-card:active{background:var(--surface2)}
  .month-card-num{font-family:var(--bc);font-size:11px;font-weight:700;letter-spacing:3px;color:var(--text-muted);text-transform:uppercase;margin-bottom:3px}
  .month-card-name{font-family:var(--bc);font-size:18px;font-weight:700;line-height:1.1}
  .month-card-arrow{font-size:13px;color:var(--text-muted);margin-top:6px}
  .week-block{background:var(--surface);border:1px solid var(--border);border-radius:10px;margin-bottom:12px;overflow:hidden}
  .week-block-header{padding:14px 16px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:background .15s}
  .week-block-header:active{background:var(--surface2)}
  .week-block-title{font-family:var(--bc);font-size:17px;font-weight:700}
  .week-block-meta{font-size:11px;color:var(--text-muted);margin-top:2px}
  .week-block-chevron{font-size:16px;color:var(--text-muted);transition:transform .2s}
  .week-block-chevron.open{transform:rotate(90deg)}
  .week-block-body{display:none;border-top:1px solid var(--border)}
  .week-block-body.open{display:block}
  .day-tab-strip{display:flex;border-bottom:1px solid var(--border)}
  .day-tab{flex:1;padding:10px 0;text-align:center;font-family:var(--bc);font-size:13px;font-weight:700;letter-spacing:2px;color:var(--text-muted);cursor:pointer;border-bottom:2px solid transparent;transition:color .15s,border-color .15s}
  .day-tab.active{color:var(--accent);border-bottom-color:var(--accent)}
  .day-panel{display:none;padding:14px 16px}
  .day-panel.active{display:block}
  .plan-exercise-row{padding:10px 0;border-bottom:1px solid var(--border);display:flex;flex-direction:column;gap:4px}
  .plan-exercise-row:last-child{border-bottom:none}
  .plan-ex-name{font-family:var(--bc);font-size:17px;font-weight:700;display:flex;align-items:center;gap:8px}
  .plan-ex-ss{font-size:9px;font-weight:700;letter-spacing:2px;color:var(--phase3);border:1px solid var(--phase3);padding:2px 5px;border-radius:3px;text-transform:uppercase}
  .plan-ex-specs{display:flex;gap:16px;margin-top:2px}
  .plan-ex-spec{display:flex;flex-direction:column}
  .plan-ex-spec-label{font-size:9px;color:var(--text-muted);letter-spacing:1px;text-transform:uppercase}
  .plan-ex-spec-val{font-family:var(--bc);font-size:15px;font-weight:600}
  .plan-ex-note{font-size:11px;color:var(--text-dim);margin-top:4px;line-height:1.4}
  .plan-progress-wrap{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:24px}
  .plan-progress-top{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:10px}
  .plan-progress-title{font-family:var(--bc);font-size:15px;font-weight:700}
  .plan-progress-count{font-family:var(--bc);font-size:13px;color:var(--text-dim)}
  .plan-overall-track{height:8px;background:var(--surface3);border-radius:4px;overflow:hidden;margin-bottom:14px}
  .plan-overall-fill{height:100%;background:var(--accent);border-radius:4px;transition:width .4s ease}
  .plan-phase-rows{display:flex;flex-direction:column;gap:8px}
  .plan-phase-row{display:flex;align-items:center;gap:10px}
  .plan-phase-row-label{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;width:60px;flex-shrink:0}
  .plan-phase-mini-track{flex:1;height:5px;background:var(--surface3);border-radius:3px;overflow:hidden}
  .plan-phase-mini-fill{height:100%;border-radius:3px;transition:width .4s ease}
  .plan-phase-row-count{font-family:var(--bc);font-size:12px;color:var(--text-muted);width:36px;text-align:right;flex-shrink:0}
  #weight-screen{background:var(--bg)}
  .weight-header{padding:calc(var(--sat) + 8px) 20px 16px;border-bottom:1px solid var(--border);flex-shrink:0}
  .weight-content{flex:1;overflow-y:auto;padding:16px 20px 90px}
  .weight-log-form{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:20px}
  .weight-form-row{display:flex;gap:10px;align-items:flex-end}
  .weight-form-group{flex:1;display:flex;flex-direction:column;gap:6px}
  .weight-form-label{font-family:var(--bc);font-size:10px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--text-muted)}
  .weight-form-input{background:var(--surface2);border:1px solid var(--border);border-radius:6px;padding:12px 14px;color:var(--text);font-family:var(--bc);font-size:22px;font-weight:700;width:100%;-webkit-appearance:none;-moz-appearance:textfield;transition:border-color .15s}
  .weight-form-input:focus{outline:none;border-color:var(--accent)}
  .weight-form-input::-webkit-inner-spin-button,.weight-form-input::-webkit-outer-spin-button{-webkit-appearance:none}
  .btn-log-weight{background:var(--accent);color:#000;font-family:var(--bc);font-size:15px;font-weight:900;letter-spacing:2px;text-transform:uppercase;padding:12px 18px;border:none;border-radius:6px;cursor:pointer;flex-shrink:0;transition:opacity .15s;white-space:nowrap}
  .btn-log-weight:active{opacity:.8}
  .weight-chart-wrap{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:20px}
  .weight-chart-title{font-family:var(--bc);font-size:15px;font-weight:700;margin-bottom:4px}
  .weight-chart-sub{font-size:11px;color:var(--text-muted);margin-bottom:14px}
  .weight-chart-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:16px}
  .wcs{background:var(--surface2);border-radius:6px;padding:10px;text-align:center}
  .wcs-val{font-family:var(--bc);font-size:22px;font-weight:900;color:var(--accent)}
  .wcs-label{font-size:9px;color:var(--text-muted);letter-spacing:1px;text-transform:uppercase;margin-top:2px}
  canvas#weight-chart{width:100%;display:block;border-radius:4px}
  .weight-log-list{display:flex;flex-direction:column;gap:0}
  .weight-log-item{display:flex;justify-content:space-between;align-items:center;padding:11px 0;border-bottom:1px solid var(--border)}
  .weight-log-item:last-child{border-bottom:none}
  .weight-log-date{font-size:13px;color:var(--text-dim)}
  .weight-log-val{font-family:var(--bc);font-size:20px;font-weight:700;color:var(--accent)}
  .weight-log-delta{font-size:11px;font-weight:600;margin-left:6px}
  .weight-log-delete{background:none;border:none;color:var(--text-muted);font-size:16px;cursor:pointer;padding:4px 8px}
  .weight-log-delete:active{color:var(--red)}
  .weight-section-label{font-family:var(--bc);font-size:10px;font-weight:700;letter-spacing:4px;color:var(--text-muted);text-transform:uppercase;margin-bottom:10px}
  .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:999;display:none;align-items:center;justify-content:center;padding:24px}
  .modal-overlay.active{display:flex}
  .modal{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;width:100%;max-width:320px}
  .modal-title{font-family:var(--bc);font-size:22px;font-weight:900;margin-bottom:8px}
  .modal-body{font-size:14px;color:var(--text-dim);line-height:1.5;margin-bottom:24px}
  .modal-buttons{display:flex;gap:10px}
  .modal-btn{flex:1;padding:14px;border:none;border-radius:8px;font-family:var(--bc);font-size:16px;font-weight:900;letter-spacing:1px;text-transform:uppercase;cursor:pointer;transition:opacity .15s}
  .modal-btn:active{opacity:.8}
  .modal-btn-cancel{background:var(--surface3);color:var(--text-dim)}
  .modal-btn-confirm{background:var(--accent);color:#000}
  #settings-screen{background:var(--bg)}
  .settings-header{padding:calc(var(--sat) + 8px) 20px 16px;border-bottom:1px solid var(--border);flex-shrink:0}
  .settings-content{flex:1;overflow-y:auto;padding:16px 20px 90px}
  .settings-section{margin-bottom:28px}
  .settings-section-label{font-family:var(--bc);font-size:10px;font-weight:700;letter-spacing:4px;color:var(--text-muted);text-transform:uppercase;margin-bottom:12px}
  .settings-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden}
  .settings-row{padding:16px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s}
  .settings-row:last-child{border-bottom:none}
  .settings-row:active{background:var(--surface2)}
  .settings-row-title{font-family:var(--bc);font-size:17px;font-weight:700}
  .settings-row-sub{font-size:11px;color:var(--text-muted);margin-top:2px}
  .settings-row-icon{font-size:20px;color:var(--text-muted)}
  .settings-row.danger .settings-row-title{color:var(--red)}
  .settings-row.danger .settings-row-icon{color:var(--red)}
  .install-banner{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px;margin-bottom:20px}
  .install-banner-title{font-family:var(--bc);font-size:17px;font-weight:700;margin-bottom:6px}
  .install-banner-steps{font-size:13px;color:var(--text-dim);line-height:1.8}
  .install-banner-steps span{color:var(--accent);font-weight:600}
  .data-info{background:var(--surface2);border-radius:8px;padding:12px 14px;font-size:12px;color:var(--text-dim);line-height:1.6;margin-bottom:20px}
  .data-info strong{color:var(--text)}
</style>
</head>
<body>
<div id="setup-screen" class="screen active">
  <div class="setup-logo">12M</div>
  <div class="setup-sub">Training Plan</div>
  <div class="setup-label">Start Date</div>
  <input type="date" class="setup-input" id="start-date-input">
  <button class="btn-primary" onclick="setupPlan()">Begin Training</button>
</div>

<div id="home-screen" class="screen">
  <div class="home-header">
    <div class="home-phase-label" id="home-phase-label"></div>
    <div class="home-title" id="home-title"></div>
    <div class="home-meta" id="home-meta"></div>
  </div>
  <div class="home-week-strip" id="home-week-strip"></div>
  <div class="home-content">
    <div id="deload-banner" class="deload-banner" style="display:none">
      <div class="deload-dot"></div>
      <div class="deload-text">DELOAD WEEK ‚Äî Reduce all loads by 40%. Active recovery.</div>
    </div>
    <div class="section-label">Today's Sessions</div>
    <div class="day-cards" id="day-cards"></div>
    <div class="section-label">Benchmarks</div>
    <div class="benchmark-card" onclick="goTo('benchmark-screen')">
      <div class="benchmark-card-header">
        <div class="benchmark-card-title">PR Tracker</div>
        <div style="font-size:16px;color:var(--text-muted)">‚Üí</div>
      </div>
      <div class="benchmark-mini-grid" id="benchmark-mini"></div>
    </div>
  </div>
</div>

<div id="workout-screen" class="screen">
  <div class="workout-header">
    <button class="workout-back" onclick="confirmExitWorkout()">‚Üê Back</button>
    <div class="workout-day-tag" id="workout-day-tag"></div>
    <div class="workout-title" id="workout-title"></div>
    <div class="workout-progress-bar"><div class="workout-progress-fill" id="workout-progress-fill" style="width:0%"></div></div>
  </div>
  <div class="timer-bar" id="timer-bar">
    <div class="timer-display" id="timer-display">00:00</div>
    <div style="flex:1;margin:0 14px">
      <div class="top-progress-label" id="top-progress-label" style="margin:0 0 3px 0">0 / 0 SETS</div>
      <div class="top-progress-track"><div class="top-progress-fill" id="top-progress-fill"></div></div>
    </div>
    <div class="timer-controls">
      <button class="timer-btn" id="timer-toggle-btn" onclick="toggleTimer()">START</button>
      <button class="timer-btn" id="timer-reset-btn" onclick="resetTimer()">RESET</button>
    </div>
  </div>
  <div class="workout-content" id="workout-content"></div>
  <div class="workout-footer">
    <button class="btn-done" id="btn-finish-workout" onclick="finishWorkout()">FINISH WORKOUT</button>
  </div>
</div>

<div id="complete-screen" class="screen">
  <div class="complete-icon">‚ö°</div>
  <div class="complete-title" id="complete-title">SESSION<br>DONE</div>
  <div class="complete-sub" id="complete-sub"></div>
  <div class="complete-stats" id="complete-stats"></div>
  <button class="btn-primary" onclick="goTo('home-screen')">BACK TO HOME</button>
</div>

<div id="benchmark-screen" class="screen">
  <div class="benchmark-header">
    <button class="workout-back" onclick="goTo('home-screen')">‚Üê Back</button>
    <div class="workout-day-tag" style="color:var(--text-dim)">PROGRESS</div>
    <div class="workout-title">PR Tracker</div>
  </div>
  <div class="benchmark-content" id="benchmark-content"></div>
</div>

<div id="history-screen" class="screen">
  <div class="history-header">
    <div style="padding-top:4px"></div>
    <div class="workout-day-tag" style="color:var(--text-dim)">LOG</div>
    <div class="workout-title">Session History</div>
  </div>
  <div class="history-content" id="history-content"></div>
</div>

<div id="plan-screen" class="screen">
  <div class="plan-header">
    <div class="plan-header-left">
      <div class="plan-screen-tag">OVERVIEW</div>
      <div class="plan-screen-title" id="plan-screen-title">The Plan</div>
    </div>
  </div>
  <div class="plan-content" id="plan-content"></div>
</div>

<div id="weight-screen" class="screen">
  <div class="weight-header">
    <div class="plan-screen-tag">TRACKING</div>
    <div class="workout-title">Body Weight</div>
  </div>
  <div class="weight-content">
    <div class="weight-log-form">
      <div class="weight-form-row">
        <div class="weight-form-group">
          <div class="weight-form-label">Weight (lbs)</div>
          <input type="number" class="weight-form-input" id="weight-input" placeholder="156" step="0.1">
        </div>
        <div class="weight-form-group" style="max-width:130px">
          <div class="weight-form-label">Date</div>
          <input type="date" class="weight-form-input" id="weight-date-input" style="font-size:14px;padding:14px 10px">
        </div>
        <button class="btn-log-weight" onclick="logWeight()">LOG</button>
      </div>
    </div>
    <div class="weight-chart-wrap" id="weight-chart-wrap" style="display:none">
      <div class="weight-chart-title">Progress</div>
      <div class="weight-chart-sub" id="weight-chart-sub"></div>
      <div class="weight-chart-stats" id="weight-chart-stats"></div>
      <canvas id="weight-chart" height="180"></canvas>
    </div>
    <div class="weight-section-label" id="weight-log-label" style="display:none">History</div>
    <div class="weight-log-list" id="weight-log-list"></div>
  </div>
</div>

<div id="settings-screen" class="screen">
  <div class="settings-header">
    <div class="plan-screen-tag">APP</div>
    <div class="workout-title">Settings</div>
  </div>
  <div class="settings-content">
    <div class="install-banner">
      <div class="install-banner-title">üì± Add to iPhone Home Screen</div>
      <div class="install-banner-steps">
        1. Tap <span>Share ‚Üë</span> in Safari<br>
        2. Scroll down and tap <span>Add to Home Screen</span><br>
        3. Tap <span>Add</span> ‚Äî done! Opens like an app.
      </div>
    </div>
    <div class="data-info">
      <strong>Your data is saved locally on this device</strong> using Safari's storage (localStorage). It persists until you clear Safari website data. Use the Export backup below to keep a copy safe.
    </div>
    <div class="settings-section">
      <div class="settings-section-label">Data & Backup</div>
      <div class="settings-card">
        <div class="settings-row" onclick="exportData()">
          <div class="settings-row-left">
            <div class="settings-row-title">Export Backup</div>
            <div class="settings-row-sub">Download all your data as a JSON file</div>
          </div>
          <div class="settings-row-icon">‚Üì</div>
        </div>
        <div class="settings-row" onclick="document.getElementById('import-file').click()">
          <div class="settings-row-left">
            <div class="settings-row-title">Import Backup</div>
            <div class="settings-row-sub">Restore from a previously exported file</div>
          </div>
          <div class="settings-row-icon">‚Üë</div>
        </div>
        <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(event)">
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-section-label">Plan</div>
      <div class="settings-card">
        <div class="settings-row" onclick="changeStartDate()">
          <div class="settings-row-left">
            <div class="settings-row-title">Change Start Date</div>
            <div class="settings-row-sub" id="settings-start-date-sub">‚Äî</div>
          </div>
          <div class="settings-row-icon">‚úé</div>
        </div>
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-section-label">Danger Zone</div>
      <div class="settings-card">
        <div class="settings-row danger" onclick="resetAllData()">
          <div class="settings-row-left">
            <div class="settings-row-title">Reset All Data</div>
            <div class="settings-row-sub">Wipe all logs, PRs, and weight entries</div>
          </div>
          <div class="settings-row-icon">‚ö†</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="confirm-modal">
  <div class="modal">
    <div class="modal-title" id="modal-title"></div>
    <div class="modal-body" id="modal-body"></div>
    <div class="modal-buttons">
      <button class="modal-btn modal-btn-cancel" onclick="closeConfirm()">Cancel</button>
      <button class="modal-btn modal-btn-confirm" id="modal-confirm-btn" onclick="confirmAction()"></button>
    </div>
  </div>
</div>

<nav class="bottom-nav" id="bottom-nav">
  <div class="nav-items">
    <button class="nav-item active" id="nav-home" onclick="navTo('home-screen','nav-home')"><span class="nav-icon">‚äû</span>Home</button>
    <button class="nav-item" id="nav-plan" onclick="navTo('plan-screen','nav-plan')"><span class="nav-icon">‚ò∞</span>Plan</button>
    <button class="nav-item" id="nav-weight" onclick="navTo('weight-screen','nav-weight')"><span class="nav-icon">‚öñ</span>Weight</button>
    <button class="nav-item" id="nav-history" onclick="navTo('history-screen','nav-history')"><span class="nav-icon">‚ó≥</span>History</button>
    <button class="nav-item" id="nav-settings" onclick="navTo('settings-screen','nav-settings')"><span class="nav-icon">‚öô</span>Settings</button>
  </div>
</nav>

<script>
// Compressed exercise helper: [name, sets, reps, rest, note, superset?]
function E(n,s,r,re,no,ss){return{name:n,sets:s,reps:r,rest:re,note:no,superset:!!ss}}
// Compressed day helper: {name, exercises[], bonus?}
function D(n,exs,b){return{name:n,exercises:exs,bonus:!!b}}

const PLAN={months:{
1:{name:"Foundation",days:{
  A:D("Full Body ‚Äî Primary",[E("Back Squat",4,"6‚Äì8","2 min","Drive knees out, stay tall, brace hard"),E("Romanian Deadlift",3,"10","90s","Hip hinge dominant ‚Äî feel the hamstrings"),E("Push Press",4,"6‚Äì8","90s","Dip, drive, press ‚Äî use the legs"),E("Bent-Over Barbell Row",3,"10","90s","Chest to bar, elbows drive back"),E("Farmer's Carry",3,"30m","60s","Shoulders packed, core rigid, walk tall",1),E("Dead Bug",3,"8/side","60s","Low back glued to floor throughout")]),
  B:D("Full Body ‚Äî Primary",[E("Trap Bar Deadlift",4,"6‚Äì8","2 min","Full hip extension lockout at top"),E("Bulgarian Split Squat",3,"8/side","90s","Front shin vertical, drive through heel"),E("Dumbbell Bench Press",3,"10","90s","Full ROM ‚Äî touch chest, lock out top"),E("Prone Dumbbell Row",3,"10","90s","Chest on bench, row to hip",1),E("Overhead Press (strict)",3,"8","90s","No leg drive ‚Äî pure shoulder strength"),E("Plank + Hip Tap",3,"30s","60s","Hips stay square ‚Äî resist rotation")]),
  C:D("Bonus ‚Äî Power + Accessory",[E("Power Clean",4,"4","2 min","Speed under the bar ‚Äî land in quarter squat"),E("Goblet Squat",3,"12","60s","Mobility + activation ‚Äî perfect depth"),E("Cable Face Pull",3,"15","60s","Elbows high, external rotation"),E("Lateral Band Walk",3,"15/side","45s","Keep band tension throughout"),E("Pallof Press",3,"10/side","60s","Anti-rotation ‚Äî do not twist"),E("Box Jump",3,"5","90s","Full reset between reps ‚Äî quality over speed")],1)}},
2:{name:"Loading",days:{
  A:D("Full Body ‚Äî Primary",[E("Back Squat",4,"5‚Äì7","2 min","Add 2.5‚Äì5kg vs Month 1 top weight"),E("Romanian Deadlift",3,"10","90s","Increase load 5% ‚Äî maintain form"),E("Push Press",4,"5‚Äì6","90s","Heavier; explosive dip-drive"),E("Pendlay Row",3,"8","90s","Bar starts on floor each rep ‚Äî explosive pull"),E("Farmer's Carry",3,"40m","60s","Heavier than Month 1",1),E("Ab Wheel Rollout",3,"10","60s","Hips don't sag ‚Äî slow and controlled")]),
  B:D("Full Body ‚Äî Primary",[E("Conventional Deadlift",4,"5","2 min","Swap trap bar ‚Äî increase neural demand"),E("Bulgarian Split Squat",3,"8/side","90s","Add weight ‚Äî front foot elevated if mobile"),E("Barbell Bench Press",3,"8","90s","Progress from DBs ‚Äî heavier compound"),E("Cable Row",3,"12","90s","Pull elbows past torso",1),E("Arnold Press",3,"10","90s","Rotation adds shoulder muscle"),E("Side Plank + Row",3,"8/side","60s","Cable or band ‚Äî anti-lateral + pulling")]),
  C:D("Bonus ‚Äî Olympic + Athletic",[E("Power Clean",4,"4","2 min","Add 2.5kg vs Month 1 ‚Äî speed still key"),E("Front Squat",3,"6","90s","Upright torso, elbows high"),E("Dumbbell Lateral Raise",3,"15","60s","Slow eccentric ‚Äî 3 counts down"),E("Nordic Hamstring Curl",3,"6","90s","Eccentric only; spotter or anchor feet"),E("Med Ball Slam",3,"8","60s","Max force ‚Äî full extension, fast slam"),E("Hanging Knee Raise",3,"12","60s","Posterior tilt pelvis at top")],1)}},
3:{name:"Intensity",days:{
  A:D("Full Body ‚Äî Primary",[E("Back Squat",5,"5","2 min","5x5 protocol ‚Äî same weight across all sets"),E("Romanian Deadlift",4,"8","90s","Heavier than Month 2"),E("Push Press",4,"5","90s","Near max ‚Äî explosive intent every rep"),E("Barbell Row",4,"8","90s","Overhand grip ‚Äî heavier load"),E("Suitcase Carry",3,"30m/side","60s","Unilateral ‚Äî fights lateral lean",1),E("Dragon Flag Progression",3,"5‚Äì8","90s","Tuck if needed ‚Äî build to full")]),
  B:D("Full Body ‚Äî Primary",[E("Deadlift",5,"4","2.5 min","Work up to top set of 4 ‚Äî heavy"),E("Walking Lunge + Dumbbells",3,"12/side","90s","Adds single-leg stability + load"),E("Incline Barbell Press",3,"8","90s","Upper chest emphasis"),E("Seated Cable Row",3,"12","90s","Close grip ‚Äî retract fully",1),E("Push Press to Behind Neck",3,"8","90s","Only if shoulder mobility allows"),E("Copenhagen Plank",3,"15s/side","60s","Adductor + core ‚Äî sport carryover")]),
  C:D("Bonus ‚Äî Power + Core",[E("Hang Power Clean",4,"4","2 min","Knee height start ‚Äî teaches explosion"),E("Paused Back Squat",3,"5","2 min","2-sec pause at bottom ‚Äî strength + mobility"),E("Single Arm DB Press",3,"10/side","90s","Anti-rotation challenge"),E("GHD Hip Extension",3,"12","60s","Posterior chain focus"),E("Broad Jump",4,"4","90s","Max distance ‚Äî reset fully between reps"),E("L-Sit Hold",3,"15‚Äì20s","60s","Parallel bars or floor ‚Äî build hold time")],1)}},
4:{name:"Peak + Test",days:{
  A:D("Full Body ‚Äî Primary",[E("Back Squat (Peak)",5,"3","3 min","Test near-max ‚Äî aim for 3RM PR"),E("Romanian Deadlift",4,"6","90s","Heavy ‚Äî same weight last 2 sets"),E("Push Press",3,"3","2 min","Explosive ‚Äî test 3RM"),E("Barbell Row",4,"6","90s","Heavy ‚Äî full ROM, no swinging"),E("Carry Complex",3,"Varied","90s","Farmer's 20m + Rack 20m + Overhead 20m",1),E("Weighted Plank",3,"30s","60s","Plate on back ‚Äî maintain position")]),
  B:D("Full Body ‚Äî Primary",[E("Deadlift (Peak)",4,"3","3 min","Work to 3RM ‚Äî log this number"),E("Bulgarian Split Squat",3,"6/side","90s","Heaviest load of the phase"),E("Barbell Bench Press",4,"5","2 min","Strength test ‚Äî aim for 5RM"),E("Weighted Pull-Up",3,"6‚Äì8","90s","Add load ‚Äî belt or dumbbell",1),E("Strict Overhead Press",3,"5","90s","Test strength ‚Äî no leg drive"),E("Single-Leg RDL",3,"8/side","60s","Balance + hamstring ‚Äî use KB or DB")]),
  C:D("Bonus ‚Äî Athletic + Peak",[E("Clean & Press Combo",5,"3","2.5 min","Power clean into push press ‚Äî athletic flow"),E("Box Squat",3,"5","2 min","Controlled descent, explosive rise"),E("Plyometric Push-Up",3,"8","90s","Hands leave floor ‚Äî power output"),E("Band Pull-Apart",3,"20","30s","Shoulder health + rear delt"),E("Sprint",4,"20s","90s","True max effort ‚Äî long rest"),E("Hollow Body Rock",3,"20","60s","Core tension through entire set")],1)}},
5:{name:"Strength Base",days:{
  A:D("Primary Strength",[E("Back Squat",5,"5","3 min","Linear progression ‚Äî add 2.5kg/week"),E("Bench Press",5,"5","2.5 min","Grip slightly wider than shoulder width"),E("Barbell Row",5,"5","2.5 min","Mirror squat day ‚Äî equal pulling volume"),E("Glute Ham Raise",3,"8","90s","True knee flexion ‚Äî not hip extension"),E("Weighted Dip",3,"8","90s","Lean forward for chest focus")]),
  B:D("Deadlift + Olympic",[E("Deadlift",4,"5","3 min","Once/week heavy ‚Äî protect CNS"),E("Overhead Press",5,"5","2.5 min","Strict form ‚Äî no lay-back"),E("Power Clean",4,"4","2.5 min","Before fatigue sets in ‚Äî speed lifts first"),E("Chin-Up (weighted)",4,"6","2 min","Slow eccentric ‚Äî 3 count down"),E("Ab Rollout",3,"12","60s","Full extension if shoulder stable")]),
  C:D("Bonus ‚Äî Power + Conditioning",[E("Snatch-Grip High Pull",4,"4","2 min","Wide grip ‚Äî hip power to bar height"),E("Paused Squat",3,"5","2.5 min","3-sec pause ‚Äî build bottom strength"),E("Close-Grip Bench",3,"8","90s","Tricep emphasis ‚Äî elbows tucked"),E("Face Pull",3,"15","60s","Shoulder health ‚Äî do not skip"),E("Sled Push",4,"20m","90s","Heavy and low ‚Äî hip extension emphasis")],1)}},
6:{name:"Strength Loading",days:{
  A:D("Primary",[E("Back Squat",5,"4","3 min","Increase weight ‚Äî lower volume per set"),E("Bench Press",5,"4","2.5 min","Add 5kg vs Month 5 working weight"),E("Pendlay Row",5,"4","2.5 min","Reset on floor ‚Äî explosive concentric"),E("Romanian Deadlift",3,"8","90s","Accessory ‚Äî hamstring hypertrophy"),E("Cable Fly + Push-Up",3,"12+8","90s","Metabolic finisher ‚Äî chest pump",1)]),
  B:D("Deadlift + Olympic",[E("Deadlift",5,"4","3 min","Heavier than Month 5"),E("Overhead Press",5,"4","2.5 min","Add 2.5kg ‚Äî strict"),E("Hang Power Snatch",4,"3","2.5 min","New skill ‚Äî lighter load, perfect form"),E("Weighted Pull-Up",4,"5","2 min","Increase weight from Phase 1"),E("Landmine Rotation",3,"10/side","60s","Rotational power ‚Äî sport pattern")]),
  C:D("Bonus ‚Äî Complex Lifts",[E("Clean Pull",4,"4","2 min","Load heavier than clean ‚Äî pull only"),E("Front Squat",4,"4","2.5 min","Upright torso ‚Äî builds clean rack position"),E("Floor Press",3,"6","2 min","No leg drive ‚Äî pure press strength"),E("Single-Arm Row (heavy)",3,"8/side","90s","Brace on bench ‚Äî max weight"),E("Prowler Sprint",4,"15m","2 min","Light + fast ‚Äî power, not strength")],1)}},
7:{name:"Intensity Peak",days:{
  A:D("Strength Peak",[E("Back Squat",6,"3","3 min","Volume + intensity ‚Äî 6 sets of 3"),E("Bench Press",4,"4","3 min","Work up to heavy top set of 4"),E("Barbell Row",4,"5","2.5 min","Heavier than Month 6"),E("Leg Press (tempo)",3,"10","90s","3 sec down, 1 up ‚Äî volume for quads"),E("Skull Crusher",3,"12","60s","Long head tricep ‚Äî overhead position")]),
  B:D("Power Peak",[E("Deadlift",4,"3","3 min","Work to near-max triple"),E("Overhead Press",4,"4","2.5 min","Work to heavy set of 4"),E("Power Clean + Front Squat",4,"2+2","3 min","Combo ‚Äî power + strength flow"),E("Weighted Pull-Up",4,"5","2 min","Add load from Month 6"),E("GHD Sit-Up",3,"12","60s","Hip flexor + core ‚Äî eccentric control")]),
  C:D("Bonus ‚Äî Jerk + Explosive",[E("Jerk (split or push)",4,"3","3 min","Overhead lockout ‚Äî shoulder stability"),E("Safety Bar Squat",3,"6","2.5 min","Different stimulus ‚Äî upper back demand"),E("Incline DB Press",3,"10","90s","Accessory upper chest"),E("T-Bar Row",3,"8","90s","Chest supported or bent over"),E("Box Jump to Depth Jump",4,"4","2 min","Land, immediately rebound ‚Äî reactive")],1)}},
8:{name:"Phase 2 Peak Test",days:{
  A:D("Strength Testing",[E("Back Squat (Peak Test)",1,"1‚Äì3","5 min","Work to heavy single or triple ‚Äî log it"),E("Bench Press (Peak Test)",1,"1‚Äì3","5 min","Test 1RM or 3RM ‚Äî record result"),E("Barbell Row",3,"5","2.5 min","Deload volume ‚Äî maintain strength"),E("Dumbbell Accessories",2,"12","60s","Light ‚Äî pump, not performance"),E("Core Circuit",2,"Varied","60s","3 movements, 45s each ‚Äî just move")]),
  B:D("Full Power Test",[E("Deadlift (Peak Test)",1,"1‚Äì3","5 min","Test 1RM or 3RM ‚Äî log it carefully"),E("Overhead Press (Peak Test)",1,"3","4 min","Test 3RM strict ‚Äî benchmark"),E("Power Clean (Max Weight)",3,"2","3 min","Heaviest clean attempt ‚Äî form first"),E("Pull-Up (max reps)",1,"Max","‚Äî","Bodyweight ‚Äî record for future reference"),E("Loaded Carry Medley",2,"Varied","2 min","All carry variations ‚Äî celebration set")]),
  C:D("Bonus ‚Äî Peak Test",[E("Power Clean (Max)",3,"2","3 min","Heaviest attempt ‚Äî speed + form"),E("Box Squat",3,"5","2 min","Explosive rise"),E("Weighted Pull-Up",3,"6","2 min","Max load"),E("Sled Push",4,"20m","90s","Heavy ‚Äî finish strong"),E("Core Circuit",2,"Varied","60s","3 movements ‚Äî celebrate")],1)}},
9:{name:"Transition",days:{
  A:D("Strength + Volume",[E("Back Squat",4,"6‚Äì8","90s","Moderate weight ‚Äî increased volume, less rest"),E("Bench Press",4,"8","90s","Hypertrophy rep range again ‚Äî pump work"),E("Cable Row",4,"12","60s","Constant tension ‚Äî full contraction"),E("Leg Extension + Leg Curl",3,"15+15","60s","Isolation for definition phase",1),E("Dips (bodyweight)",3,"Max","60s","Max reps ‚Äî push endurance"),E("Metabolic Finisher",1,"8 min","‚Äî","EMOM: 5 KB swings + 5 push-ups each minute")]),
  B:D("Athletic Power",[E("Power Clean",4,"4","2 min","Maintain Olympic lifting ‚Äî athletic base"),E("Front Squat",3,"8","90s","High volume front squats ‚Äî quad focus"),E("Push Press",4,"8","90s","Moderate weight ‚Äî explosiveness maintained"),E("Pull-Up Cluster",4,"6‚Äì8","90s","Supinate grip variety ‚Äî bicep + back"),E("Landmine Press (split stance)",3,"10/side","60s","Sport-pattern pressing"),E("Sled/Prowler (conditioning)",4,"30m","90s","Moderate load ‚Äî aerobic capacity")]),
  C:D("Bonus ‚Äî Conditioning Focus",[E("Kettlebell Complex",4,"5 rounds","2 min","Swing + Clean + Press + Squat ‚Äî unbroken"),E("Single-Leg RDL",3,"10/side","60s","Balance + posterior chain"),E("Arnold Press",3,"12","60s","Shoulder detail ‚Äî full rotation"),E("Face Pull",3,"20","45s","Rear delt + rotator cuff health"),E("Battle Rope or Jump Rope",4,"30s","30s","Conditioning ‚Äî work:rest 1:1"),E("Hollow Rock",3,"30s","45s","Core endurance")],1)}},
10:{name:"Definition Push",days:{
  A:D("Volume + Definition",[E("Back Squat",4,"8‚Äì10","90s","Volume up ‚Äî definition phase loading"),E("Incline Bench Press",4,"10","90s","Upper chest focus for shape"),E("Barbell Row",4,"10","90s","Controlled ‚Äî squeeze at top"),E("Walking Lunge (weighted)",3,"12/side","60s","Glute + quad definition"),E("Cable Fly",3,"15","45s","Stretch at bottom ‚Äî no touching at top"),E("Metabolic Finisher",1,"10 min","‚Äî","AMRAP: 8 box jumps + 8 DB thrusters + 200m row")]),
  B:D("Power + Conditioning",[E("Hang Power Snatch",4,"4","2 min","Speed and precision ‚Äî not max load"),E("Box Squat",3,"6","2 min","Explosive ‚Äî drive up fast"),E("Strict Press",4,"8","90s","Keep pressing strength with volume"),E("Weighted Chin-Up",4,"8","90s","Heavy ‚Äî back thickness work"),E("Tyre Flip or Sled Drag",4,"20m","90s","Raw power + conditioning blend"),E("Copenhagen Plank",3,"20s/side","45s","Adductor strength ‚Äî hockey carry-over")]),
  C:D("Bonus ‚Äî Sport + Athletic",[E("Sport Circuit",5,"3 rounds","90s","Box jump + Sprint + Med Ball Slam ‚Äî explosive"),E("Paused Goblet Squat",3,"12","60s","Mobility maintenance ‚Äî deep squat"),E("Lateral Raise (cable)",3,"15","45s","Side delt detail"),E("Hamstring Curl",3,"12","60s","Injury prevention ‚Äî eccentric control"),E("Farmer's Carry + Sprint finish",3,"30m+15m","90s","Drop weights and sprint ‚Äî contrast"),E("Plank Variations Circuit",2,"3 min","60s","4 plank positions ‚Äî 45s each")],1)}},
11:{name:"Final Build",days:{
  A:D("Heavy + Volume",[E("Back Squat",5,"5","2.5 min","Return to strength rep range ‚Äî carry both"),E("Bench Press",5,"5","2.5 min","Heavy again ‚Äî maintain Phase 2 gains"),E("Barbell Row",5,"5","2.5 min","Match squat ‚Äî balanced push/pull"),E("Leg Press",3,"15","60s","Volume add ‚Äî legs are priority"),E("Skullcrusher + Curl",3,"12+12","60s","Arm detail + symmetry",1),E("Weighted Vest Walk / Hike",1,"20 min","‚Äî","Low intensity ‚Äî recovery + conditioning")]),
  B:D("Full Athletic Expression",[E("Clean & Jerk (complex)",5,"2+2","3 min","Show off your year of work ‚Äî max weight"),E("Front Squat",3,"5","2.5 min","Strength ‚Äî close to Phase 2 loads"),E("Push Press",3,"5","2 min","Heavy ‚Äî athletic overhead power"),E("Pull-Up (weighted)",4,"6","2 min","Strongest you've ever been ‚Äî test it"),E("Athletic Circuit",3,"4 min","2 min","Sprint + Jump + Carry ‚Äî sport feel")]),
  C:D("Bonus ‚Äî Plyometric + Carry",[E("Plyometric Complex",4,"4","2 min","Depth jump + Broad jump + Sprint ‚Äî max CNS"),E("Loaded Carry Medley",3,"Varied","2 min","All carries ‚Äî test your grip + core"),E("Band Work (shoulder care)",2,"20/side","30s","Rotator cuff ‚Äî maintain health"),E("Core Circuit (max effort)",3,"5 min","2 min","Dragon flag + L-sit + Hollow rock"),E("Grip Training",2,"30s","60s","Dead hang or towel pull-up")],1)}},
12:{name:"Year-End Peak",days:{
  A:D("Full Year PR Test",[E("Back Squat (Year PR)",1,"1‚Äì5","5 min","Test your actual year progress ‚Äî 1, 3, or 5RM"),E("Bench Press (Year PR)",1,"1‚Äì5","5 min","Same ‚Äî log and compare to Month 1"),E("Deadlift (Year PR)",1,"1‚Äì5","5 min","Heavy pull ‚Äî celebrate this moment"),E("Barbell Row (Year PR)",3,"5","3 min","Heaviest row of your life ‚Äî earn it"),E("Overhead Press (Year PR)",3,"5","3 min","Finish with your strict press best")]),
  B:D("Celebration + Reflection",[E("Clean & Press (Year Max)",4,"2","3 min","Max load ‚Äî clean into push press"),E("Squat Variation of Choice",3,"8","90s","Your favourite ‚Äî reward yourself"),E("Pull-Up (bodyweight max)",2,"Max","3 min","Compare to Month 8 result"),E("Loaded Carry (celebration)",3,"Free","90s","Just carry heavy things ‚Äî enjoy it"),E("Core + Mobility Flow",1,"15 min","‚Äî","Wind down ‚Äî honour the year")]),
  C:D("Bonus ‚Äî Sport + Recovery",[E("Sport Day ‚Äî Free Choice",0,"‚Äî","‚Äî","Play a sport, skate, run, be athletic"),E("Reflect + Deload",0,"‚Äî","‚Äî","Light movement only ‚Äî celebrate recovery"),E("Written Benchmark Review",0,"‚Äî","‚Äî","Log all PRs vs start ‚Äî month by month")],1)}}
}};

const BENCHMARKS=[{key:"squat",name:"Back Squat (3RM)"},{key:"deadlift",name:"Deadlift (3RM)"},{key:"bench",name:"Bench Press (3RM)"},{key:"ohp",name:"Overhead Press (3RM)"},{key:"clean",name:"Power Clean (max)"},{key:"pullups",name:"Pull-Ups (max reps)"},{key:"bw",name:"Bodyweight (lbs)"}];
const PHASES=[{num:1,months:[1,2,3,4],name:"HYPERTROPHY",color:"phase-1"},{num:2,months:[5,6,7,8],name:"STRENGTH + POWER",color:"phase-2"},{num:3,months:[9,10,11,12],name:"RECOMPOSITION + PEAK",color:"phase-3"}];

let state={startDate:null,log:{},benchmarks:{},completedDays:{}};

// ---- Timer ----
let timerInterval=null,timerSeconds=0,timerRunning=false;

function formatTime(s){
  const h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;
  if(h>0)return`${h}:${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
  return`${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
}

function updateTimerDisplay(){
  document.getElementById('timer-display').textContent=formatTime(timerSeconds);
}

function toggleTimer(){
  const btn=document.getElementById('timer-toggle-btn');
  if(timerRunning){
    clearInterval(timerInterval);timerInterval=null;timerRunning=false;
    btn.textContent='RESUME';btn.className='timer-btn paused';
  } else {
    timerRunning=true;
    timerInterval=setInterval(()=>{timerSeconds++;updateTimerDisplay();},1000);
    btn.textContent='PAUSE';btn.className='timer-btn running';
  }
}

function resetTimer(){
  clearInterval(timerInterval);timerInterval=null;timerRunning=false;timerSeconds=0;
  updateTimerDisplay();
  const btn=document.getElementById('timer-toggle-btn');
  btn.textContent='START';btn.className='timer-btn';
}

function stopTimer(){
  clearInterval(timerInterval);timerInterval=null;timerRunning=false;
}

// ---- State persistence ----
async function saveState(){
  try{localStorage.setItem('stefan_workout_v1',JSON.stringify(state));}catch(e){}
  try{await window.storage.set('workout_v1',JSON.stringify(state));}catch(e){}
}
async function loadState(){
  try{const s=localStorage.getItem('stefan_workout_v1');if(s){state=JSON.parse(s);return;}}catch(e){}
  try{const r=await window.storage.get('workout_v1');if(r&&r.value){state=JSON.parse(r.value);return;}}catch(e){}
}

function getCurrentPosition(){
  if(!state.startDate)return null;
  const start=new Date(state.startDate),today=new Date();
  const diffDays=Math.floor((today-start)/(864e5));
  const week=Math.floor(diffDays/7)+1;
  const month=Math.min(Math.ceil(week/4),12);
  const weekInMonth=((week-1)%4)+1;
  return{week,month,weekInMonth,isDeload:weekInMonth===4,phase:PHASES.find(p=>p.months.includes(month))};
}

function setupPlan(){
  const val=document.getElementById('start-date-input').value;
  if(!val)return;
  state.startDate=val;saveState();
  initHomeScreen();goTo('home-screen');
  document.getElementById('bottom-nav').classList.add('visible');
}

function goTo(screenId){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(screenId).classList.add('active');
  if(screenId==='home-screen')initHomeScreen();
  if(screenId==='plan-screen')initPlanScreen();
  if(screenId==='weight-screen')initWeightScreen();
  if(screenId==='benchmark-screen')initBenchmarkScreen();
  if(screenId==='history-screen')initHistoryScreen();
  if(screenId==='settings-screen')initSettingsScreen();
}
function navTo(screenId,navId){
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById(navId).classList.add('active');
  goTo(screenId);
}

function initHomeScreen(){
  const pos=getCurrentPosition();if(!pos)return;
  const{month,weekInMonth,isDeload,phase,week}=pos;
  const md=PLAN.months[month];
  const pl=document.getElementById('home-phase-label');
  pl.textContent=`PHASE ${phase.num} ‚Äî ${phase.name}`;pl.className=`home-phase-label ${phase.color}`;
  document.getElementById('home-title').textContent=`MONTH ${month} ‚Äî ${md.name.toUpperCase()}`;
  document.getElementById('home-meta').textContent=`Week ${weekInMonth} of 4  ¬∑  Overall Week ${week}`;
  const strip=document.getElementById('home-week-strip');strip.innerHTML='';
  for(let i=1;i<=4;i++){const p=document.createElement('div');p.className='week-pip'+(i<weekInMonth?' done':i===weekInMonth?' current':'');strip.appendChild(p);}
  document.getElementById('deload-banner').style.display=isDeload?'flex':'none';
  const cards=document.getElementById('day-cards');cards.innerHTML='';
  ['A','B','C'].forEach(day=>{
    const dd=md.days[day];const isBonus=dd.bonus;
    const sk=`${month}_${weekInMonth}_${day}`;const isDone=state.completedDays[sk];
    const card=document.createElement('div');
    card.className=`day-card${isBonus?' bonus':''}${isDone?' completed':''}`;
    card.innerHTML=`<div><div class="day-card-tag">Day ${day}${isBonus?' ¬∑ Optional':' ¬∑ Required'}</div><div class="day-card-name">${dd.name}</div><div class="day-card-count">${dd.exercises.length} exercises</div></div>${isDone?`<button class="day-card-undo" onclick="event.stopPropagation();undoDay('${sk}')">UNDO</button>`:'<div class="day-card-arrow">‚Üí</div>'}`;
    if(!isDone)card.onclick=()=>startWorkout(month,weekInMonth,day);cards.appendChild(card);
  });
  const mini=document.getElementById('benchmark-mini');mini.innerHTML='';
  ['squat','deadlift','bench','ohp'].forEach(key=>{
    const lift=BENCHMARKS.find(b=>b.key===key);const vals=state.benchmarks[key]||{};
    const v=vals.m12||vals.m8||vals.m4||vals.m1||'‚Äî';
    mini.innerHTML+=`<div><div class="benchmark-mini-label">${lift.name.replace(' (3RM)','')}</div><div class="benchmark-mini-val ${v!=='‚Äî'?'filled':''}">${v!=='‚Äî'?v+' lbs':'‚Äî'}</div></div>`;
  });
}

let currentWorkout={month:null,week:null,day:null,logKey:null};

// ---- Back button confirmation ----
function confirmExitWorkout(){
  showConfirm(
    'Exit Workout?',
    'You have an active workout in progress. Your unsaved data for this session will be lost.',
    'Exit',
    ()=>{stopTimer();resetTimer();goTo('home-screen');}
  );
}

function startWorkout(month,week,day){
  const dayData=PLAN.months[month].days[day];
  currentWorkout={month,week,day,logKey:`${month}_${week}_${day}`};
  const phase=PHASES.find(p=>p.months.includes(month));
  const tag=document.getElementById('workout-day-tag');
  tag.textContent=`PHASE ${phase.num} ¬∑ MONTH ${month} ¬∑ DAY ${day}`;tag.className=`workout-day-tag ${phase.color}`;
  document.getElementById('workout-title').textContent=dayData.name.toUpperCase();
  // Reset timer
  resetTimer();
  const content=document.getElementById('workout-content');content.innerHTML='';
  const lastSessionData=getLastSessionWeights(day);
  const rpeOpts=[6,7,8,9,10].map(v=>`<option value="${v}">${v}</option>`).join('');
  dayData.exercises.forEach((ex,exIdx)=>{
    const exDiv=document.createElement('div');exDiv.className='exercise-item';exDiv.id=`ex-${exIdx}`;
    const lastW=lastSessionData[ex.name];
    let lastHint='';
    if(lastW){
      const rpeLabel=lastW.avgRPE?` ¬∑ RPE ${lastW.avgRPE.toFixed(1)}`:'';
      let suggestHTML='';
      if(lastW.suggested!=null){
        const diff=lastW.suggested-lastW.last;
        const arrow=diff>0?'‚Üë':diff<0?'‚Üì':'‚Üí';
        const color=diff>0?'var(--green)':diff<0?'var(--red)':'var(--accent-dim)';
        suggestHTML=`<span style="color:${color};margin-left:10px">${arrow} Aim for <strong>${lastW.suggested} lbs</strong>${diff!==0?` (${diff>0?'+':''}${diff})`:''}</span>`;
      }
      lastHint=`<div class="last-weight-hint">Last: <span>${lastW.last} lbs${rpeLabel}</span>${suggestHTML}</div>`;
    }
    let setsHTML='';const numSets=ex.sets||1;
    for(let s=0;s<numSets;s++){
      setsHTML+=`<div class="log-set-row"><div class="set-num">S${s+1}</div><div class="log-input-wrap"><div class="log-input-label">WEIGHT (lbs)</div><input type="number" class="log-input" id="w-${exIdx}-${s}" placeholder="‚Äî" oninput="onInputChange(${exIdx},${s})" onfocus="this.select()"></div><div class="rpe-wrap"><div class="log-input-label">RPE</div><select class="rpe-select" id="r-${exIdx}-${s}" onchange="onInputChange(${exIdx},${s})"><option value="">‚Äî</option>${rpeOpts}</select></div><button class="set-check" id="chk-${exIdx}-${s}" onclick="toggleSetDone(${exIdx},${s})">‚óã</button></div>`;
    }
    exDiv.innerHTML=`<div class="exercise-header"><div class="exercise-name">${ex.name}</div>${ex.superset?'<div class="exercise-superset-tag">SUPERSET</div>':''}</div><div class="exercise-specs"><div><div class="spec-label">Sets</div><div class="spec-val">${ex.sets||'‚Äî'}</div></div><div><div class="spec-label">Reps</div><div class="spec-val">${ex.reps}</div></div><div><div class="spec-label">Rest</div><div class="spec-val">${ex.rest}</div></div></div><div class="exercise-note${ex.superset?' superset-note':''}">${ex.note}</div>${lastHint}<div class="log-sets">${setsHTML}</div>`;
    content.appendChild(exDiv);
  });
  updateProgress();goTo('workout-screen');
  // Scroll to top on workout start
  setTimeout(()=>{document.getElementById('workout-content').scrollTop=0;},50);
}

function undoDay(sk){delete state.completedDays[sk];saveState();initHomeScreen();}

function getLastSessionWeights(dayLetter){
  const result={};
  const keys=Object.keys(state.log).filter(k=>k.endsWith('_'+dayLetter)).sort().reverse();
  if(!keys.length)return result;
  const last=state.log[keys[0]];
  Object.keys(last).forEach(exName=>{
    const sets=last[exName];
    const weights=sets.map(s=>parseFloat(s.weight)).filter(v=>!isNaN(v)&&v>0);
    const rpes=sets.map(s=>parseFloat(s.rpe)).filter(v=>!isNaN(v)&&v>0);
    if(!weights.length)return;
    const maxW=Math.max(...weights);
    const avgRPE=rpes.length?rpes.reduce((a,b)=>a+b,0)/rpes.length:null;
    let suggested=null;
    if(avgRPE!=null){
      if(avgRPE<=6)suggested=maxW+10;
      else if(avgRPE<=8)suggested=maxW+5;
      else if(avgRPE<=9)suggested=maxW;
      else suggested=Math.max(maxW-5,0);
    }
    result[exName]={last:maxW,avgRPE,suggested};
  });
  return result;
}

function onInputChange(exIdx,setIdx){
  const w=document.getElementById(`w-${exIdx}-${setIdx}`);
  const r=document.getElementById(`r-${exIdx}-${setIdx}`);
  w.classList.toggle('filled',!!w.value);
  r.classList.toggle('filled',!!r.value);
  updateProgress();
}
function toggleSetDone(exIdx,setIdx){
  const chk=document.getElementById(`chk-${exIdx}-${setIdx}`);
  const done=chk.classList.toggle('done');chk.textContent=done?'‚úì':'‚óã';updateProgress();
}
function updateProgress(){
  const dd=PLAN.months[currentWorkout.month].days[currentWorkout.day];
  let total=0,done=0;
  dd.exercises.forEach((ex,exIdx)=>{for(let s=0;s<(ex.sets||1);s++){total++;const chk=document.getElementById(`chk-${exIdx}-${s}`);if(chk?.classList.contains('done'))done++;}});
  const pct=total>0?done/total*100:0;
  document.getElementById('workout-progress-fill').style.width=pct+'%';
  document.getElementById('top-progress-fill').style.width=pct+'%';
  document.getElementById('top-progress-label').textContent=`${done} / ${total} SETS`;
  document.getElementById('btn-finish-workout').classList.toggle('ready',done>0);
}

function finishWorkout(){
  showConfirm(
    'Complete Workout?',
    'This will mark the session as done and save your log.',
    'Complete',
    ()=>{
      stopTimer();
      const dd=PLAN.months[currentWorkout.month].days[currentWorkout.day];
      const logEntry={};let totalWeight=0,setsLogged=0;
      dd.exercises.forEach((ex,exIdx)=>{
        logEntry[ex.name]=[];
        for(let s=0;s<(ex.sets||1);s++){
          const w=document.getElementById(`w-${exIdx}-${s}`)?.value||'';
          const r=document.getElementById(`r-${exIdx}-${s}`)?.value||'';
          const done=document.getElementById(`chk-${exIdx}-${s}`)?.classList.contains('done')||false;
          logEntry[ex.name].push({weight:w,rpe:r,done});
          if(w){totalWeight+=parseFloat(w)||0;setsLogged++;}
        }
      });
      const dateStr=new Date().toISOString().split('T')[0];
      state.log[`${dateStr}_${currentWorkout.day}`]=logEntry;
      state.completedDays[currentWorkout.logKey]=true;saveState();
      document.getElementById('complete-title').innerHTML='SESSION<br>DONE';
      document.getElementById('complete-sub').textContent=`Month ${currentWorkout.month}, Day ${currentWorkout.day} ‚Äî logged ‚úì`;
      const avgW=setsLogged>0?Math.round(totalWeight/setsLogged):0;
      const exDone=dd.exercises.filter((e,i)=>{for(let s=0;s<(e.sets||1);s++){if(document.getElementById(`chk-${i}-${s}`)?.classList.contains('done'))return true;}return false;}).length;
      const timeStr=formatTime(timerSeconds);
      document.getElementById('complete-stats').innerHTML=`<div class="complete-stat"><div class="complete-stat-val">${timeStr}</div><div class="complete-stat-label">Duration</div></div><div class="complete-stat"><div class="complete-stat-val">${setsLogged}</div><div class="complete-stat-label">Sets Logged</div></div><div class="complete-stat"><div class="complete-stat-val">${avgW||'‚Äî'}</div><div class="complete-stat-label">Avg Weight</div></div><div class="complete-stat"><div class="complete-stat-val">${exDone}</div><div class="complete-stat-label">Exercises Done</div></div>`;
      resetTimer();
      goTo('complete-screen');
    }
  );
}

function initBenchmarkScreen(){
  const content=document.getElementById('benchmark-content');content.innerHTML='';
  const phases=['m1','m4','m8','m12'],phaseLabels=['Month 1','Month 4','Month 8','Month 12'];
  BENCHMARKS.forEach(lift=>{
    const vals=state.benchmarks[lift.key]||{};
    const div=document.createElement('div');div.className='benchmark-lift';
    const cellsHTML=phases.map((p,pi)=>{
      const val=vals[p]||'';
      const delta=pi>0&&vals[phases[0]]&&val?(parseFloat(val)-parseFloat(vals[phases[0]])):null;
      const deltaHTML=delta!=null&&delta!==0?`<div class="bpc-delta">${delta>0?'+':''}${delta} lbs</div>`:'';
      return`<div><div class="bpc-label">${phaseLabels[pi]}</div><input type="number" class="bpc-input ${val?'filled':''}" value="${val}" placeholder="‚Äî" onchange="saveBenchmark('${lift.key}','${p}',this.value)" oninput="this.classList.toggle('filled',!!this.value)" onfocus="this.select()">${deltaHTML}</div>`;
    }).join('');
    div.innerHTML=`<div class="benchmark-lift-name">${lift.name}</div><div class="benchmark-phases">${cellsHTML}</div>`;
    content.appendChild(div);
  });
}
function saveBenchmark(key,phase,value){
  if(!state.benchmarks[key])state.benchmarks[key]={};
  state.benchmarks[key][phase]=value;saveState();initBenchmarkScreen();
}

function initHistoryScreen(){
  const content=document.getElementById('history-content');content.innerHTML='';
  const keys=Object.keys(state.log).sort().reverse();
  if(!keys.length){content.innerHTML='<div class="empty-state"><div class="empty-state-icon">‚ó≥</div><div class="empty-state-text">No sessions logged yet.<br>Complete your first workout to see history here.</div></div>';return;}
  keys.forEach(key=>{
    const parts=key.split('_');const day=parts[parts.length-1];const date=parts.slice(0,3).join('-');
    const entry=state.log[key];const exercises=Object.keys(entry);
    const dateObj=new Date(date+'T12:00:00');
    const dateStr=dateObj.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
    const div=document.createElement('div');div.className='history-session';
    let exHTML=exercises.slice(0,4).map(exName=>{
      const sets=entry[exName];
      const weights=sets.map(s=>s.weight).filter(Boolean);
      const maxW=weights.length?Math.max(...weights.map(Number)):null;
      const rpes=sets.map(s=>s.rpe).filter(Boolean);
      const avgRPE=rpes.length?(rpes.reduce((a,b)=>a+Number(b),0)/rpes.length).toFixed(1):null;
      const val=[maxW?maxW+' lbs':null,avgRPE?'RPE '+avgRPE:null].filter(Boolean).join(' ¬∑ ');
      return`<div class="history-exercise-row"><div class="history-ex-name">${exName}</div><div class="history-ex-vals">${val||'‚Äî'}</div></div>`;
    }).join('');
    if(exercises.length>4)exHTML+=`<div class="history-exercise-row"><div class="history-ex-name" style="color:var(--text-muted)">+${exercises.length-4} more</div></div>`;
    div.innerHTML=`<div class="history-session-header"><div class="history-session-title">Day ${day}</div><div class="history-session-date">${dateStr}</div></div>${exHTML}`;
    content.appendChild(div);
  });
}

// ---- Weight Tracking ----
function initWeightScreen(){
  document.getElementById('weight-date-input').value=new Date().toISOString().split('T')[0];
  renderWeightScreen();
}

function logWeight(){
  const val=parseFloat(document.getElementById('weight-input').value);
  const date=document.getElementById('weight-date-input').value;
  if(!val||!date)return;
  if(!state.weightLog)state.weightLog=[];
  state.weightLog=state.weightLog.filter(e=>e.date!==date);
  state.weightLog.push({date,weight:val});
  state.weightLog.sort((a,b)=>a.date.localeCompare(b.date));
  saveState();
  document.getElementById('weight-input').value='';
  renderWeightScreen();
}

function deleteWeight(date){
  state.weightLog=state.weightLog.filter(e=>e.date!==date);
  saveState();renderWeightScreen();
}

function renderWeightScreen(){
  const log=(state.weightLog||[]).slice().sort((a,b)=>a.date.localeCompare(b.date));
  const chartWrap=document.getElementById('weight-chart-wrap');
  const logLabel=document.getElementById('weight-log-label');
  const logList=document.getElementById('weight-log-list');
  if(!log.length){
    chartWrap.style.display='none';logLabel.style.display='none';
    logList.innerHTML='<div class="empty-state"><div class="empty-state-icon">‚öñ</div><div class="empty-state-text">No entries yet.<br>Log your first weigh-in above.</div></div>';
    return;
  }
  chartWrap.style.display='block';logLabel.style.display='block';
  const weights=log.map(e=>e.weight);
  const first=weights[0],last=weights[weights.length-1];
  const min=Math.min(...weights),max=Math.max(...weights);
  const change=+(last-first).toFixed(1);
  const changeStr=(change>0?'+':'')+change;
  const changeColor=change<0?'var(--green)':change>0?'var(--red)':'var(--accent)';
  document.getElementById('weight-chart-sub').textContent=`${log.length} weigh-in${log.length!==1?'s':''}`;
  document.getElementById('weight-chart-stats').innerHTML=`<div class="wcs"><div class="wcs-val">${last}</div><div class="wcs-label">Current</div></div><div class="wcs"><div class="wcs-val" style="color:${changeColor}">${changeStr}</div><div class="wcs-label">Change</div></div><div class="wcs"><div class="wcs-val">${first}</div><div class="wcs-label">Start</div></div>`;
  // Draw chart
  const canvas=document.getElementById('weight-chart');
  const dpr=window.devicePixelRatio||1;
  const displayW=canvas.parentElement.clientWidth-32,displayH=180;
  canvas.style.width=displayW+'px';canvas.style.height=displayH+'px';
  canvas.width=displayW*dpr;canvas.height=displayH*dpr;
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  const pad={top:16,right:16,bottom:28,left:42};
  const W=displayW-pad.left-pad.right,H=displayH-pad.top-pad.bottom;
  const range=max-min||1;const yMin=min-range*0.1,yMax=max+range*0.1;
  const xPos=i=>pad.left+(log.length>1?i/(log.length-1)*W:W/2);
  const yPos=v=>pad.top+H-(v-yMin)/(yMax-yMin)*H;
  ctx.strokeStyle='#2a2a2a';ctx.lineWidth=1;
  for(let i=0;i<=4;i++){
    const y=pad.top+i*(H/4);
    ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(pad.left+W,y);ctx.stroke();
    ctx.fillStyle='#555';ctx.font='10px sans-serif';ctx.textAlign='right';
    ctx.fillText((yMax-(i/4)*(yMax-yMin)).toFixed(1),pad.left-5,y+4);
  }
  const labelIdxs=log.length<=6?log.map((_,i)=>i):[0,...[1,2,3].map(i=>Math.round(i*(log.length-1)/3)),log.length-1].filter((v,i,a)=>a.indexOf(v)===i);
  ctx.fillStyle='#555';ctx.textAlign='center';ctx.font='9px sans-serif';
  labelIdxs.forEach(i=>{const d=new Date(log[i].date+'T12:00:00');ctx.fillText(`${d.getMonth()+1}/${d.getDate()}`,xPos(i),pad.top+H+18);});
  if(log.length>1){
    const grad=ctx.createLinearGradient(0,pad.top,0,pad.top+H);
    grad.addColorStop(0,'rgba(232,255,0,0.18)');grad.addColorStop(1,'rgba(232,255,0,0)');
    ctx.beginPath();ctx.moveTo(xPos(0),yPos(log[0].weight));
    log.forEach((e,i)=>{if(i>0)ctx.lineTo(xPos(i),yPos(e.weight));});
    ctx.lineTo(xPos(log.length-1),pad.top+H);ctx.lineTo(xPos(0),pad.top+H);ctx.closePath();ctx.fillStyle=grad;ctx.fill();
  }
  ctx.beginPath();ctx.strokeStyle='#e8ff00';ctx.lineWidth=2;ctx.lineJoin='round';ctx.lineCap='round';
  log.forEach((e,i)=>{i===0?ctx.moveTo(xPos(i),yPos(e.weight)):ctx.lineTo(xPos(i),yPos(e.weight));});ctx.stroke();
  log.forEach((e,i)=>{ctx.beginPath();ctx.arc(xPos(i),yPos(e.weight),3.5,0,Math.PI*2);ctx.fillStyle='#e8ff00';ctx.fill();});
  const reversed=[...log].reverse();
  logList.innerHTML=reversed.map((e,i)=>{
    const prev=reversed[i+1];const delta=prev?+(e.weight-prev.weight).toFixed(1):null;
    const deltaHTML=delta!=null?`<span class="weight-log-delta" style="color:${delta<0?'var(--green)':delta>0?'var(--red)':'var(--text-muted)'}">${delta>0?'+':''}${delta}</span>`:'';
    const d=new Date(e.date+'T12:00:00');
    return`<div class="weight-log-item"><div class="weight-log-date">${d.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})}</div><div style="display:flex;align-items:baseline;gap:2px"><div class="weight-log-val">${e.weight}</div><div style="font-size:11px;color:var(--text-muted)">lbs</div>${deltaHTML}<button class="weight-log-delete" onclick="deleteWeight('${e.date}')" title="Delete">√ó</button></div></div>`;
  }).join('');
}

// ---- Settings ----
function initSettingsScreen(){
  const sub=document.getElementById('settings-start-date-sub');
  if(state.startDate){const d=new Date(state.startDate+'T12:00:00');sub.textContent='Started '+d.toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'});}
  else sub.textContent='Not set';
}
function exportData(){
  const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);const a=document.createElement('a');
  a.href=url;a.download=`stefan-workout-backup-${new Date().toISOString().split('T')[0]}.json`;
  document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);
}
function importData(event){
  const file=event.target.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=async(e)=>{
    try{
      const imported=JSON.parse(e.target.result);
      if(!imported||typeof imported!=='object')throw 0;
      if(!confirm('Import this backup? This will replace all current data.'))return;
      state=imported;await saveState();initHomeScreen();alert('Data imported successfully!');navTo('home-screen','nav-home');
    }catch(err){alert('Could not read backup file.');}
  };
  reader.readAsText(file);event.target.value='';
}
function changeStartDate(){
  const newDate=prompt('Enter new start date (YYYY-MM-DD):',state.startDate||'');
  if(!newDate||newDate===state.startDate)return;
  if(!/^\d{4}-\d{2}-\d{2}$/.test(newDate)){alert('Invalid date format. Use YYYY-MM-DD');return;}
  state.startDate=newDate;saveState();initSettingsScreen();alert('Start date updated.');
}
function resetAllData(){
  if(!confirm('Are you sure? This will delete ALL your workout logs, PRs, weight entries, and progress. This cannot be undone.'))return;
  if(!confirm('Really sure? Export a backup first if you want to keep your data.'))return;
  state={startDate:state.startDate,log:{},benchmarks:{},completedDays:{},weightLog:[]};
  saveState();alert('All data cleared.');navTo('home-screen','nav-home');
}

// ---- Confirm modal ----
let confirmCallback=null;
function showConfirm(title,body,confirmLabel,onConfirm){
  document.getElementById('modal-title').textContent=title;
  document.getElementById('modal-body').textContent=body;
  document.getElementById('modal-confirm-btn').textContent=confirmLabel;
  confirmCallback=onConfirm;
  document.getElementById('confirm-modal').classList.add('active');
}
function closeConfirm(){document.getElementById('confirm-modal').classList.remove('active');confirmCallback=null;}
document.getElementById('confirm-modal').addEventListener('click',function(e){if(e.target===this)closeConfirm();});
function confirmAction(){if(confirmCallback)confirmCallback();closeConfirm();}

// ---- Plan browser ----
function initPlanScreen(){
  const content=document.getElementById('plan-content');content.innerHTML='';
  document.getElementById('plan-screen-title').textContent='The Plan';
  let totalRequired=0,totalDone=0;
  const phaseProgress=PHASES.map(phase=>{
    let req=0,done=0;
    phase.months.forEach(m=>{[1,2,3,4].forEach(w=>{['A','B'].forEach(d=>{req++;if(state.completedDays[`${m}_${w}_${d}`])done++;});});});
    totalRequired+=req;totalDone+=done;return{phase,req,done};
  });
  const dotC=['var(--phase1)','var(--phase2)','var(--phase3)'],barC=['#e8ff00','#ff8c00','#00d4ff'],pcC=['phase-1','phase-2','phase-3'];
  const phaseRowsHTML=phaseProgress.map((pp,pi)=>`<div class="plan-phase-row"><div class="plan-phase-row-label" style="color:${dotC[pi]}">P${pp.phase.num}</div><div class="plan-phase-mini-track"><div class="plan-phase-mini-fill" style="width:${pp.req>0?Math.round(pp.done/pp.req*100):0}%;background:${barC[pi]}"></div></div><div class="plan-phase-row-count">${pp.done}/${pp.req}</div></div>`).join('');
  const pw=document.createElement('div');pw.className='plan-progress-wrap';
  pw.innerHTML=`<div class="plan-progress-top"><div class="plan-progress-title">Overall Progress</div><div class="plan-progress-count">${totalDone} / ${totalRequired} sessions</div></div><div class="plan-overall-track"><div class="plan-overall-fill" style="width:${totalRequired>0?Math.round(totalDone/totalRequired*100):0}%"></div></div><div class="plan-phase-rows">${phaseRowsHTML}</div>`;
  content.appendChild(pw);
  PHASES.forEach((phase,pi)=>{
    const block=document.createElement('div');block.className='phase-block';
    const monthCards=phase.months.map(m=>{
      const md=PLAN.months[m];let mReq=0,mDone=0;
      [1,2,3,4].forEach(w=>['A','B'].forEach(d=>{mReq++;if(state.completedDays[`${m}_${w}_${d}`])mDone++;}));
      return`<div class="month-card ${pcC[pi]}-card" onclick="showMonthDetail(${m})"><div class="month-card-num">Month ${m}</div><div class="month-card-name">${md.name}</div><div style="margin-top:8px;height:3px;background:var(--surface3);border-radius:2px;overflow:hidden"><div style="height:100%;width:${Math.round(mDone/mReq*100)}%;background:${barC[pi]};border-radius:2px"></div></div><div class="month-card-arrow" style="margin-top:6px">${mDone}/${mReq} ¬∑ View ‚Üí</div></div>`;
    }).join('');
    block.innerHTML=`<div class="phase-block-header"><div class="phase-dot" style="background:${dotC[pi]}"></div><div class="phase-block-title ${pcC[pi]}">Phase ${phase.num} ‚Äî ${phase.name}</div></div><div class="month-grid">${monthCards}</div>`;
    content.appendChild(block);
  });
}

function showMonthDetail(monthNum){
  const md=PLAN.months[monthNum];const phase=PHASES.find(p=>p.months.includes(monthNum));
  const focuses=[
    ['Orientation','Technique Lock-In','Progressive Load','Deload'],['Volume Increase','Progressive Overload','Intensity Surge','Deload'],
    ['5x5 Strength Start','Load Progression','Peak Sets','Deload + Assess'],['Peaking','PR Attempts','Phase Tests','Phase Close'],
    ['Establish Weights','Progressive Overload','Intensity Surge','Deload'],['Strength Loading','Progressive Overload','Intensity Surge','Deload'],
    ['Intensity Peak','Load Progression','Peak Sets','Deload'],['Full Test','Full Test','Full Test','Deload'],
    ['Transition','Build','Peak','Deload'],['Definition Push','Build','Peak','Deload'],
    ['Final Build','Final Build','Peak','Deload'],['Year-End Peak','PR Test','Celebration','Deload']
  ][monthNum-1]||['Week 1','Week 2','Week 3','Week 4'];
  const content=document.getElementById('plan-content');
  content.innerHTML=`<button class="plan-back-btn" onclick="initPlanScreen();document.getElementById('plan-screen-title').textContent='The Plan'">‚Üê All Phases</button><div style="margin-bottom:6px"><span class="plan-screen-tag">Phase ${phase.num} ¬∑ Month ${monthNum}</span></div><div style="font-family:var(--bc);font-size:28px;font-weight:900;margin-bottom:20px">${md.name.toUpperCase()}</div><div id="weeks-list"></div>`;
  document.getElementById('plan-screen-title').textContent=`Month ${monthNum}`;
  const weeksList=document.getElementById('weeks-list');
  [1,2,3,4].forEach(w=>{
    const block=document.createElement('div');block.className='week-block';
    const bodyId=`wb-body-${w}`,chevId=`wb-chev-${w}`;
    block.innerHTML=`<div class="week-block-header" onclick="toggleWeek('${bodyId}','${chevId}')"><div><div class="week-block-title">Week ${w}${w===4?' ‚Äî Deload':''}</div><div class="week-block-meta">${focuses[w-1]}</div></div><div class="week-block-chevron" id="${chevId}">‚Ä∫</div></div><div class="week-block-body" id="${bodyId}">${buildDayTabs(monthNum,w)}</div>`;
    weeksList.appendChild(block);
  });
}

function toggleWeek(bodyId,chevId){
  document.getElementById(bodyId).classList.toggle('open');
  document.getElementById(chevId).classList.toggle('open');
}

function buildDayTabs(monthNum,week){
  const days=['A','B','C'];
  const tabsHTML=days.map((d,i)=>`<div class="day-tab${i===0?' active':''}" onclick="switchDayTab(${monthNum},${week},'${d}',this)">Day ${d}</div>`).join('');
  const panelsHTML=days.map((d,i)=>{
    const dd=PLAN.months[monthNum].days[d];
    const exRows=dd.exercises.map(ex=>`<div class="plan-exercise-row"><div class="plan-ex-name">${ex.name}${ex.superset?'<span class="plan-ex-ss">SS</span>':''}</div><div class="plan-ex-specs"><div class="plan-ex-spec"><div class="plan-ex-spec-label">Sets</div><div class="plan-ex-spec-val">${ex.sets||'‚Äî'}</div></div><div class="plan-ex-spec"><div class="plan-ex-spec-label">Reps</div><div class="plan-ex-spec-val">${ex.reps}</div></div><div class="plan-ex-spec"><div class="plan-ex-spec-label">Rest</div><div class="plan-ex-spec-val">${ex.rest}</div></div></div><div class="plan-ex-note">${ex.note}</div></div>`).join('');
    const deloadNote=week===4?'<div style="font-size:12px;color:#ff8c00;background:#ff8c0011;border:1px solid #ff8c0033;border-radius:6px;padding:10px 12px;margin-bottom:12px">‚ö† Deload week ‚Äî reduce all loads by 40%</div>':'';
    const bonusNote=dd.bonus?'<div style="font-size:11px;color:var(--text-muted);margin-bottom:10px;letter-spacing:1px">OPTIONAL BONUS DAY</div>':'';
    return`<div class="day-panel${i===0?' active':''}" id="panel-${monthNum}-${week}-${d}">${deloadNote}${bonusNote}${exRows}</div>`;
  }).join('');
  return`<div class="day-tab-strip">${tabsHTML}</div>${panelsHTML}`;
}

function switchDayTab(monthNum,week,day,tabEl){
  tabEl.parentElement.querySelectorAll('.day-tab').forEach(t=>t.classList.remove('active'));
  tabEl.classList.add('active');
  ['A','B','C'].forEach(d=>{const p=document.getElementById(`panel-${monthNum}-${week}-${d}`);if(p)p.classList.toggle('active',d===day);});
}

async function init(){
  await loadState();
  document.getElementById('start-date-input').value=new Date().toISOString().split('T')[0];
  if(state.startDate){initHomeScreen();goTo('home-screen');document.getElementById('bottom-nav').classList.add('visible');document.getElementById('nav-home').classList.add('active');}
  // Fix 6: Scroll inputs into view on focus to prevent keyboard overlap on iPhone
  document.addEventListener('focus',function(e){
    if(e.target.tagName==='INPUT'||e.target.tagName==='SELECT'){
      setTimeout(()=>{e.target.scrollIntoView({behavior:'smooth',block:'center'});},300);
    }
  },true);
}
init();
</script>

</body>
</html>